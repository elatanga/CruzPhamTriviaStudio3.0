
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Default Deny
    match /{document=**} {
      allow read, write: if false;
    }

    // --- TEMPLATES ---
    // Users can read own templates.
    // Writes are strictly controlled via Admin functions or specific endpoints, 
    // but assuming client-side persistence simulation for this app, we block direct writes
    // to enforce the "server functions only" architecture requested.
    match /templates/{templateId} {
      allow read: if request.auth.uid == resource.data.ownerId;
      // No write allowed from client SDK. Use server functions.
    }

    // --- GAME STATE ---
    // Users can read current game state if they own it.
    match /games/{gameId} {
      allow read: if request.auth.uid == resource.data.hostId;
    }

    // --- ADMIN & AUTH COLLECTIONS ---
    // NO PUBLIC ACCESS. Backend Only.
    match /admins/{adminId} {
      allow read, write: if false;
    }
    
    match /users/{userId} {
      allow read, write: if false;
    }

    match /tokens/{tokenId} {
      allow read, write: if false;
    }

    match /sessions/{sessionId} {
      allow read, write: if false;
    }

    match /auditLogs/{logId} {
      allow read, write: if false;
    }
  }
}
